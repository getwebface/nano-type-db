name = "nanotype-db"
main = "src/index.ts"
compatibility_date = "2024-04-05"
compatibility_flags = ["nodejs_compat"]

# Define the Durable Object binding
[[durable_objects.bindings]]
name = "DATA_STORE"
class_name = "DataStore"

# Database migrations
[[migrations]]
tag = "v1"
new_classes = ["DataStore"]

# Rules for SQLite storage
# Durable object binding is defined above using the
# `[[durable_objects.bindings]]` array; the alternate `[durable_objects]`
# table form was removed to avoid redefinition errors.

# Backups
[[r2_buckets]]
binding = "BACKUP_BUCKET"
bucket_name = "nanotype-backups"

# Auth Database (D1)
# The D1 database binding is commented out because a valid `database_id` is
# required to deploy. To enable, create a D1 database and replace the
# `database_id` value below (run `npx wrangler d1 create nanotype-auth` to
# create one and obtain the id), then uncomment the block.
# [[d1_databases]]
# binding = "AUTH_DB"
# database_name = "nanotype-auth"
# database_id = "<your-d1-database-id>"

# Rate limiting, vector index, and AI bindings were removed/commented
# because these top-level fields are not recognized by `wrangler.toml` and
# caused build-time warnings or provisioning errors. If you intend to use
# Cloudflare Vectorize, AI, or custom rate-limits, provision those resources
# separately in the Cloudflare dashboard and add valid bindings here.
#
# Example (commented):
# [[rate_limits]]
# binding = "RATE_LIMITER"
# namespace_id = "<namespace-id>"
# simple = { limit = 100, period = 60 }
#
# [[vectorize]]
# binding = "VECTOR_INDEX"
# index_name = "<existing-index-name>"
#
# [ai]
# binding = "AI"

# Cron Trigger for Backups (Every hour)
[triggers]
crons = ["0 * * * *"]
