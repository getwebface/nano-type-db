name = "nanotype-db"
main = "src/index.ts"
compatibility_date = "2024-04-05"
compatibility_flags = ["nodejs_compat"]

# Define the Durable Object binding
[[durable_objects.bindings]]
name = "DATA_STORE"
class_name = "DataStore"

# Database migrations
[[migrations]]
tag = "v1"
new_classes = ["DataStore"]

# Backups
[[r2_buckets]]
binding = "BACKUP_BUCKET"
bucket_name = "nanotype-backups"

# Auth Database (D1)
[[d1_databases]]
binding = "AUTH_DB"
database_name = "nanotype-auth"
database_id = "d1b3a27b-a1de-43ab-ba7f-5ebda88b9807"

# Observability Configuration (Fixed TOML Syntax)
[observability]
enabled = false
head_sampling_rate = 1

[observability.logs]
enabled = true
head_sampling_rate = 1
invocation_logs = true

[observability.traces]
enabled = false
head_sampling_rate = 1

# Vector Index & AI
[[vectorize]]
binding = "VECTOR_INDEX"
index_name = "nanotype-vectors"

[ai]
binding = "AI"

# Static Assets (React Frontend)
[assets]
binding = "ASSETS"
directory = "./dist"

# Rate Limit (Optional - uncomment if you have a namespace)
# [[rate_limits]]
# binding = "RATE_LIMITER"
# namespace_id = "<namespace-id>"
# simple = { limit = 100, period = 60 }

# Cron Trigger for Backups (Every hour)
[triggers]
crons = ["0 * * * *"]
