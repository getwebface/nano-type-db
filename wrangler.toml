name = "nanotype-db"
main = "src/index.ts"
compatibility_date = "2024-04-05"
compatibility_flags = ["nodejs_compat"]

# Define the Durable Object binding
[[durable_objects.bindings]]
name = "DATA_STORE"
class_name = "DataStore"

# Database migrations
[[migrations]]
tag = "v1"
new_classes = ["DataStore"]

# Rules for SQLite storage
[durable_objects]
bindings = [
  { name = "DATA_STORE", class_name = "DataStore" }
]

# Backups
[[r2_buckets]]
binding = "BACKUP_BUCKET"
bucket_name = "nanotype-backups"

# Auth Database (D1)
[[d1_databases]]
binding = "AUTH_DB"
database_name = "nanotype-auth"
database_id = "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx" # Run `npx wrangler d1 create nanotype-auth` to get ID

# Cron Trigger for Backups (Every hour)
[triggers]
crons = ["0 * * * *"]
